---
title: "X-Y_Plots"
author: "Elizabeth Van Metre"
date: '2023-02-10'
output: html_document
---

-------------IMPORTANT FILE PATHS/VALUES-------------

```{r}
filepath = "~/Desktop/Arctic/" #Set to prefix of your file location

#Daily Step
datemin = "2022-06-19"
datemax = "2022-06-25"
datestep = "1 day"
dateminstep = "6 hours"
```


-------------DATA SETUP AND CLEANING-------------

```{r}
library(ggplot2)
library(plyr)
library(dplyr)
library(lubridate)
library(tidyr)
library(gridExtra)
library(forcats)
library(splitstackshape) # basically like text to columns
library(naniar)
library(RColorBrewer)
```

Ground Temperatures for all sites data prepping
```{r}
# importing ground temp data for 6-19 through 9-20
grndtmp=read.csv(paste(filepath,"Season_GRNDTMP_6_19_22_9_20_22_2022_09_21_16_19_26_UTC_1.csv",sep = ""))
 
# data cleaning for dataset
names(grndtmp) <- sub("....C..RX3000_BRW1", "", names(grndtmp))
names(grndtmp) <- sub("....C..RX3000_BRW4", "", names(grndtmp))
names(grndtmp) <- sub("....C..RX3000_BRW5", "", names(grndtmp))
names(grndtmp) <- sub("....C..RX3000_BRW6", "", names(grndtmp))
names(grndtmp) <- sub(".RXW.GP6.", "", names(grndtmp))
names(grndtmp) <- sub("Temperature.", "", names(grndtmp))
grndtmp$Date <-as.POSIXct(grndtmp$Date,format="%m/%d/%y %H:%M",tz="UTC")

#Air Temp Sensor - Remove
grndtmp = grndtmp[,-14]

#THESE ARE BLANK COLUMNS - rewrite if using a different data set
#NOTE: these have gaps in the BEGINNING part of data collection - may not always be blank
grndtmp = grndtmp[,-c(26:36)]
grndtmp = grndtmp[,-c(92:201)]
```


Ground Moisture for all sites data prepping
```{r}
mst=read.csv(paste(filepath,"Season_VWC_6_19_22_9_20_22_2022_09_21_16_11_28_UTC_1.csv",sep = ""))

names(mst) <- sub("...m.3.m.3..RX3000_BRW1", "", names(mst))
names(mst) <- sub("...m.3.m.3..RX3000_BRW4", "", names(mst))
names(mst) <- sub("...m.3.m.3..RX3000_BRW5", "", names(mst))
names(mst) <- sub("...m.3.m.3..RX3000_BRW6", "", names(mst))
names(mst) <- sub("..RXW.GP6.", "", names(mst))
mst$Date <-as.POSIXct(mst$Date,format="%m/%d/%y %H:%M",tz="UTC")
```

Solar radiation for all sites data prepping
```{r}
solarrad = read.csv(paste(filepath,"Season_SOLARAD_6_19_22_9_20_22_2022_09_21_16_27_20_UTC_1.csv",sep = ""))

names(solarrad) <- sub("olar.Radiation..RXW.LIB", "" ,names(solarrad))
names(solarrad) <- sub("olar.Radiation..S.LIB", "" ,names(solarrad))
names(solarrad) <- sub("S.", "" ,names(solarrad))
names(solarrad) <- sub("...W.m.2..RX3000_BRW1", "" ,names(solarrad))
names(solarrad) <- sub("...W.m.2..RX3000_BRW4", "" ,names(solarrad))
names(solarrad) <- sub("...W.m.2..RX3000_BRW5", "" ,names(solarrad))
names(solarrad) <- sub("...W.m.2..RX3000_BRW6", "" ,names(solarrad))
solarrad$Date <- as.POSIXct(solarrad$Date,format="%m/%d/%y %H:%M",tz="UTC")
```

#Upload air temp data and clean
```{r}
airtemp =read.csv(paste(filepath,"Season_AIRTMP_6_19_22_9_20_22_2022_09_21_16_21_48_UTC_1.csv",sep = ""))

names(airtemp) <- sub("Temperature..RXW.THC.", "" ,names(airtemp))
names(airtemp) <- sub("Temperature..S.THC.", "" ,names(airtemp))
names(airtemp) <- sub("S.", "" ,names(airtemp))
names(airtemp) <- sub("....C..RX3000_BRW1", "" ,names(airtemp))
names(airtemp) <- sub("....C..RX3000_BRW4", "" ,names(airtemp))
names(airtemp) <- sub("....C..RX3000_BRW5", "" ,names(airtemp))
names(airtemp) <- sub("....C..RX3000_BRW6", "" ,names(airtemp))
airtemp$Date <- as.POSIXct(airtemp$Date,format="%m/%d/%y %H:%M",tz="UTC")
```


-------Convert to Long DataFrame-------

#Solar Radiation
```{r fig9, fig.heigt = 14, fig.width = 18}
raw_solar = solarrad

solarrad = gather(solarrad, variable, response, '21401801.21362319.1':'21198259.21398620.1') %>%
  filter(!is.na(response)) %>%
  mutate(variable = fct_inorder(variable))

solarrad= cSplit(solarrad, 'variable', sep=".", direction = "wide") # texttocols, 
solarrad$variable_3 <- NULL
colnames(solarrad)[3:5] <- c("value", "station", "sensor")
solarrad$value <- as.numeric(as.character(solarrad$value)) 
solarrad$sensor <- as.factor(as.character(solarrad$sensor))
solarrad$station <- as.factor(solarrad$station)

solarrad$station <- revalue(solarrad$station, c("21198259" = "TNHA", "21401800" = "BUECI", "21401801" = "SSMH", "21401803" = "BEO"))





solarrad$sensor <- revalue(solarrad$sensor, c("21390411" = "BUECI-BASE", "21398618" = "BUCEI-SA", "21398624" = "BUECI-SB", "21362313" = "BUCEI-SC", "21362316" = "BUCEI-SD", "21362320" = "BUCEI-SE", "21398578" = "BUCEI-SF.01", "21398598" = "BUCEI-SF.02", 
                                              "21390413" ="SSMH-BASE", "21398622" = "SSMH-SA", "21362319" = "SSMH-SB", "21166008" = "SSMH-SC", "21393049" = "SSMH-SD" ,
                                              "21176526" = "TNHA-BASE", "21398620" = "TNHA-SA", "21398616"="TNHA-SB","21362315" = "TNHA-SD", "21362317" = "TNHA-SC", 
                                              "21390415" = "BEO-Base"))

```

```{r fig9, fig.heigt = 14, fig.width = 18}
raw_ground = grndtmp

grndtmp = gather(grndtmp, variable, response, 3:ncol(grndtmp)) %>%
  filter(!is.na(response)) %>%
  mutate(variable = fct_inorder(variable))

grndtmp= cSplit(grndtmp, 'variable', sep=".", direction = "wide") # texttocols, 
grndtmp$variable_3 <- NULL
colnames(grndtmp)[3:5] <- c("value", "station", "sensor")
grndtmp$value <- as.numeric(as.character(grndtmp$value)) 
grndtmp$sensor <- as.factor(as.character(grndtmp$sensor))
grndtmp$station <- as.factor(grndtmp$station)

grndtmp$station <- revalue(grndtmp$station, c("21198259" = "TNHA", "21401800" = "BUECI", "21401801" = "SSMH", "21401803" = "BEO"))



#Find Sensor Values

grndtmp$sensor <- revalue(grndtmp$sensor, c("21398585" = "BUECI-BASE", "21398590" = "BUCEI-SA", "21398583" = "BUECI-SB", "21393042" = "BUCEI-SC", "21398584" = "BUCEI-SD", "21398579" = "BUCEI-SE", "21398578" = "BUCEI-SF.01", "21398598" = "BUCEI-SF.02", "21398588" ="SSMH-BASE","21393049" = "SSMH-SD", "21398599" = "SSMH-SA", "21393044" = "SSMH-SB", "21393049" = "SSMH-SD" , "21206939" = "TNHA-BASE", "21398593" = "TNHA-SA", "21398576"="TNHA-SB","21398601" = "TNHA-SD", "21393047" = "TNHA-SC", "21393048" = "BEO-B06", "21398591" = "BEO-B05"))

```

-------Convert to Daily Values-------

```{r}
avgdailysolar = data.frame(Date=NA, value=NA, sensor=NA)[numeric(0), ]
sensorList = c("TNHA-BASE", "TNHA-SA", "TNHA-SB", "TNHA-SC", "TNHA-SD")


for(sensorName in sensorList){
  daily = solarrad %>% filter(sensor==sensorName) %>% filter(as.Date(Date, "%Y-%m-%d") <= datemax) %>%                 filter(as.Date(Date, "%Y-%m-%d") >= datemin)

  daily$Date = floor_date(daily$Date, unit = "days", week_start = getOption("lubridate.week.start",      7))

  daily = aggregate(value ~ Date, daily, mean, na.rm=T)
  sensor = rep(sensorName, nrow(daily))
  daily = data.frame(daily, sensor)
  avgdailysolar = rbind(avgdailysolar, daily)
}

colnames(avgdailysolar)[2] = "solar"

```

```{r}
avgdailyground = data.frame(Date=NA, value=NA, sensor=NA)[numeric(0), ]
sensorList = c("TNHA-BASE", "TNHA-SA", "TNHA-SB", "TNHA-SC", "TNHA-SD")


for(sensorName in sensorList){
  #Make sure sensor has data - otherwise will throw error
    
    daily = grndtmp %>% filter(sensor==sensorName) %>% filter(as.Date(Date, "%Y-%m-%d") <= datemax) %>%                 filter(as.Date(Date, "%Y-%m-%d") >= datemin)
if(nrow(daily) > 0){
  daily$Date = floor_date(daily$Date, unit = "days", week_start = getOption("lubridate.week.start",      7))

  daily = aggregate(value ~ Date, daily, mean, na.rm=T)
  sensor = rep(sensorName, nrow(daily))
  daily = data.frame(daily, sensor)
  avgdailyground = rbind(avgdailyground, daily)
}

  
}

colnames(avgdailyground)[2] = "solar"

```

-------Graphs for One Week-------

-------Example GGPlot2 from Mirella--------

TNHA only VWC
```{r fig8, fig.height = 15, fig.width = 18}
df4 <- df %>% filter(!station == "BUECI", 
                             !station =="BEO", 
                             !station == "SSMH")

ggplot(subset(df4, 
              depth %in% c("0:15cm","30:45cm","60:75cm", "75:90cm")), 
       aes(x=Date, y= response, color = sensor)) + 
  geom_point(size = 0.5) +
  guides(color = guide_legend(override.aes = list(size=10))) +
  facet_grid(depth~station) + 
  theme_bw() +
  labs(title= "Ground Moisture", y="Volumetric Water Content ("~m^3~"/"~m^3~")",color="Station") + 
  scale_x_datetime(date_breaks = "1 weeks") +
  theme(axis.text.y = element_text(size = 15)) +
  theme(axis.text.x=element_text(angle = 45, hjust = 1.0, size = 15), 
        axis.line = element_line(colour = "black", size =0.5, 
                                 linetype = "solid")) +
  theme(strip.text.y = element_text(size = 15),plot.title = element_text(hjust = 0.5, size = 30), 
        plot.caption = element_text(face ="italic"),
        strip.text = element_text(size = 20),
        axis.title = element_text(size = 20)) +
  theme(axis.title.y = element_text(margin = margin(r=15))) +
  theme(axis.title.x = element_text(margin = margin(t=15))) +
  theme(legend.title = element_text(size = 20),
        legend.text = element_text(size = 10),
        legend.key.height = unit(1,'cm')) +
  scale_colour_hue(breaks=c("TNHA-BASE","TNHA-SA", "TNHA-SC", "TNHA-SD"))
#SB removed as there is no data tied to it in hobolink
```





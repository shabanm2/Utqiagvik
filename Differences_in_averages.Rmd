---
title: "Differences_in_averages"
author: "Mirella Shaban"
date: "2024-01-19"
output: html_document

############################################################
THIS SCRIPT GIVES YOU THE SEASONAL AVERAGES *(GROUND TEMPERATURE)*
1) BY SITE & 2) BY ASPECT (AT SAME SITE)
3*) AVERAGES SENSORS BY a) STATION AND BY b) SITE WITHIN THE SCRIPT FOR THE COMPARISONS

*MUST *RUN LOADANDCLEAN_DIFFERENCES_IN_AVERAGES.RMD BEFORE THIS SCRIPT TO LOAD IN THE CLEANED DATA FOR EACH SEASON *
############################################################
---
*Names of seasonal data files (cleaned) BY STATION*
SUMMERGRND22_ALLDEPTHS
FALL22_ALLDEPTHS
SPRING23_ALLDEPTHS
SUMMERGRND23_ALLDEPTHS
FALL23_ALLDEPTHS *use the BASE STATION as the SOUTH SENSOR here Because SA HAS NO DATA*

*Names of seasonal data files (cleaned) BY SITE*
SITES_AVG_SUM22_GRND
SITES_AVG_FALL22_GRND
SITES_AVG_SPRING23_GRND
SITES_AVG_SUM23_GRND
SITES_AVG_FALL23_GRND


DF for HOURLY / HOUR comparisons between stations: CHANGE NAME OF DF YOU WANT --> FROM RAW DATA
```{r}
grndtmp_hourly <- summer22grndtmp  %>%
  group_by(sensor, depth, hour = floor_date(Date, "hour"), day = floor_date(Date, "day")) %>%
  summarize(avg_ground_temp = mean(value))


NS_Hourly <- grndtmp_hourly %>% filter(sensor == "TNHA-SC" | sensor == "TNHA-SA" | sensor == "SSMH-SA" | sensor == "SSMH-SB")
NS_Hourly <- NS_Hourly %>% filter(depth == "10cm")

Hourly_Comparisons <- NS_Hourly %>%
    pivot_wider(names_from = sensor, values_from = avg_ground_temp)

Hourly_Comparisons$TNHA_NS <- Hourly_Comparisons$`TNHA-SA` - Hourly_Comparisons$`TNHA-SC`
Hourly_Comparisons$SSMH_NS <- Hourly_Comparisons$`SSMH-SA` - Hourly_Comparisons$`SSMH-SB`


#below, gives row with max value of interest
Hourly_Comparisons[which.max(Hourly_Comparisons$SSMH_NS), ]

```



*SUMMER 22* STATS: average daily difference between SITES (all stations combined) for Xcm depth (define in x <- )
```{r}
wide <- SITES_AVG_SUM22_GRND %>%
    pivot_wider(names_from = station, values_from = value)

wide$TBDIFF <- wide$TNHA - wide$BEO
wide$SBDIFF <- wide$SSMH - wide$BEO
wide$TBSBDIFF <- wide$SSMH - wide$TNHA

x<- wide %>% filter(depth == "10cm") 
mean(x$TBDIFF,na.rm = TRUE)
mean(x$SBDIFF, na.rm = TRUE)
mean(x$TBSBDIFF, na.rm = TRUE)
```



*SUMMER 23* AVERAGE BY STATION (can compare sensors at the same site, such as N & S) by day
```{r}
averaged_by_station <- SUMMERGRND23_ALLDEPTHS %>% filter(fullname == "TNHA-SA") %>% aggregate(value~date+depth, mean)
averaged_by_station$fullname <- c("TNHA-SA")
averaged_by_station2 <- SUMMERGRND23_ALLDEPTHS %>% filter(fullname == "TNHA-SC") %>% aggregate(value~date+depth, mean)
averaged_by_station2$fullname <- c("TNHA-SC")
averaged_by_station3 <- SUMMERGRND23_ALLDEPTHS %>% filter(fullname == "SSMH-SA") %>% aggregate(value~date+depth, mean)
averaged_by_station3$fullname <- c("SSMH-SA")
averaged_by_station4 <- SUMMERGRND23_ALLDEPTHS %>% filter(fullname == "SSMH-SB") %>% aggregate(value~date+depth, mean)
averaged_by_station4$fullname <- c("SSMH-SB")
averaged_by_station5 <- SUMMERGRND23_ALLDEPTHS %>% filter(fullname == "BEO-B05" | fullname == "BEO-B06") %>% aggregate(value~date+depth, mean)
averaged_by_station5$fullname <- c("BEO")
sum23_STATIONS_AVG<- rbind(averaged_by_station, averaged_by_station2, averaged_by_station3,averaged_by_station4,averaged_by_station5)
```


*SUMMER 23* STATS: average daily difference between SPECIFIC STATIONS for Xcm depth (define in x <- )
```{r}
wide <- sum23_STATIONS_AVG %>%
    pivot_wider(names_from = fullname, values_from = value)

wide$TNHA_NS_DIFF <- wide$`TNHA-SA` - wide$`TNHA-SC`
wide$TNHA_N_BEO_DIFF <- wide$`TNHA-SC` - wide$`BEO`
wide$TNHA_S_BEO_DIFF <- wide$`TNHA-SA` - wide$`BEO`

wide$SSMH_NS_DIFF <- wide$`SSMH-SA` - wide$`SSMH-SB`
wide$SSMH_N_BEO_DIFF <- wide$`SSMH-SB` - wide$`BEO`
wide$SSMH_S_BEO_DIFF <- wide$`SSMH-SA` - wide$`BEO`

wide$TNHA_SSMH_N_COMP <- wide$`TNHA-SC`-wide$`SSMH-SB`
wide$TNHA_SSMH_S_COMP <- wide$`TNHA-SA`-wide$`SSMH-SA`

#write.csv(wide, "~/Desktop/UVA/RESEARCH/Barrow/Meteorological_Seasons_Data/Summer_daily_average_difference_N_vs_S.csv")

x<- wide %>% filter(depth == "90cm") 

mean(x$TNHA_NS_DIFF,na.rm = TRUE)
mean(x$SSMH_NS_DIFF, na.rm = TRUE)


mean(x$TNHA_S_BEO_DIFF, na.rm = TRUE)
mean(x$SSMH_S_BEO_DIFF, na.rm = TRUE)

mean(x$TNHA_SSMH_N_COMP, na.rm = TRUE)

max(x$TNHA_NS_DIFF, na.rm = TRUE)
max(x$SSMH_NS_DIFF, na.rm = TRUE)


#below, p1 = 6/19-8/01 , p2= 8/01-
#p1 = with(x, mean(TNHA_SSMH_N_COMP[date >= "2022-06-19" & date <= "2022-07-08"])) #this excludes NA values from avging


#x #this ignores NA values, any date with data will be factored in to the average --> USE THIS FOR THE BAR PLOTS, ABOVE FOR TABLES
#p1

```

*FALL 22* 
AVERAGE BY SITE
-----------
```{r}
averaged_by_site_TNHA <- FALL22_ALLDEPTHS %>% filter(fullname == "TNHA-BASE" | fullname == "TNHA-SA" | fullname == "TNHA-SB"| fullname == "TNHA-SC" | fullname == "TNHA-SD") %>% aggregate(value~date+depth+val, mean, na.rm=FALSE)
averaged_by_site_TNHA$station <- c("TNHA")

averaged_by_site_BEO <- FALL22_ALLDEPTHS %>% filter(fullname == "BEO-B06" | fullname == "BEO-B05") %>% aggregate(value~date+depth+val, mean, na.rm=FALSE)
averaged_by_site_BEO$station <- c("BEO") 

averaged_by_site_SSMH <- FALL22_ALLDEPTHS %>% filter(fullname == "SSMH-BASE" | fullname == "SSMH-SA" | fullname == "SSMH-SB"| fullname == "SSMH-SC" | fullname == "SSMH-SD") %>% aggregate(value~date+depth+val, mean, na.rm=FALSE)
averaged_by_site_SSMH$station <- c("SSMH")

SITES_AVG_FALL22_GRND <- rbind(averaged_by_site_BEO, averaged_by_site_TNHA, averaged_by_site_SSMH)
```


*FALL 22*  STATS: average daily difference between SITES (all stations combined) for Xcm depth (define in x <- )
```{r}
wide <- SITES_AVG_FALL22_GRND %>%
    pivot_wider(names_from = station, values_from = value)

wide$TBDIFF <- wide$TNHA - wide$BEO
wide$SBDIFF <- wide$SSMH - wide$BEO
wide$TBSBDIFF <- wide$SSMH - wide$TNHA

x<- wide %>% filter(depth == "30cm") 
mean(x$TBDIFF,na.rm = TRUE)
mean(x$SBDIFF, na.rm = TRUE)
mean(x$TBSBDIFF, na.rm = TRUE)
```

*FALL 22*  AVERAGE BY STATION (can compare sensors at the same site, such as N & S) by day
```{r}
averaged_by_station <- FALL22_ALLDEPTHS %>% filter(fullname == "TNHA-SA") %>% aggregate(value~date+depth, mean)
averaged_by_station$fullname <- c("TNHA-SA")
averaged_by_station2 <- FALL22_ALLDEPTHS %>% filter(fullname == "TNHA-SC") %>% aggregate(value~date+depth, mean)
averaged_by_station2$fullname <- c("TNHA-SC")
averaged_by_station3 <- FALL22_ALLDEPTHS %>% filter(fullname == "SSMH-SA") %>% aggregate(value~date+depth, mean)
averaged_by_station3$fullname <- c("SSMH-SA")
averaged_by_station4 <- FALL22_ALLDEPTHS %>% filter(fullname == "SSMH-SB") %>% aggregate(value~date+depth, mean)
averaged_by_station4$fullname <- c("SSMH-SB")
averaged_by_station5 <- FALL22_ALLDEPTHS %>% filter(fullname == "BEO-B05" | fullname == "BEO-B06") %>% aggregate(value~date+depth, mean)
averaged_by_station5$fullname <- c("BEO")
FALL22_STATIONS_AVG<- rbind(averaged_by_station, averaged_by_station2, averaged_by_station3,averaged_by_station4,averaged_by_station5)
```


*FALL 22*  STATS: average daily difference between SPECIFIC STATIONS for Xcm depth (define in x <- )
```{r}
wide <- FALL22_STATIONS_AVG %>%
    pivot_wider(names_from = fullname, values_from = value)

wide$TNHA_NS_DIFF <- wide$`TNHA-SA` - wide$`TNHA-SC`
wide$TNHA_N_BEO_DIFF <- wide$`TNHA-SC` - wide$`BEO`
wide$TNHA_S_BEO_DIFF <- wide$`TNHA-SA` - wide$`BEO`
wide$SSMH_NS_DIFF <- wide$`SSMH-SA` - wide$`SSMH-SB`
wide$SSMH_N_BEO_DIFF <- wide$`SSMH-SB` - wide$`BEO`
wide$SSMH_S_BEO_DIFF <- wide$`SSMH-SA` - wide$`BEO`
wide$TNHA_SSMH_N_COMP <- wide$`TNHA-SC`-wide$`SSMH-SB`
wide$TNHA_SSMH_S_COMP <- wide$`TNHA-SA`-wide$`SSMH-SA`

#write.csv(wide, "~/Desktop/UVA/RESEARCH/Barrow/Meteorological_Seasons_Data/Summer_daily_average_difference_N_vs_S.csv")

x<- wide %>% filter(depth == "10cm") 

mean(x$TNHA_NS_DIFF,na.rm = TRUE)
mean(x$SSMH_NS_DIFF, na.rm = TRUE)
mean(x$TNHA_S_BEO_DIFF, na.rm = TRUE)
mean(x$SSMH_S_BEO_DIFF, na.rm = TRUE)

max(x$TNHA_NS_DIFF, na.rm = TRUE)
max(x$SSMH_NS_DIFF, na.rm = TRUE)

mean(x$TNHA_SSMH_N_COMP, na.rm = TRUE)



p2 = with(x, mean(TNHA_SSMH_N_COMP[date >= "2022-09-01" & date <= "2022-12-01"]))
#p1

```

--------

*SPRING 23* 
--------
```{r}
averaged_by_site_TNHA <- SPRING23_ALLDEPTHS %>% filter(fullname == "TNHA-BASE" | fullname == "TNHA-SA" | fullname == "TNHA-SB"| fullname == "TNHA-SC" | fullname == "TNHA-SD") %>% aggregate(value~date+depth+val, mean, na.rm=FALSE)
averaged_by_site_TNHA$station <- c("TNHA")

averaged_by_site_BEO <- SPRING23_ALLDEPTHS %>% filter(fullname == "BEO-B06" | fullname == "BEO-B05") %>% aggregate(value~date+depth+val, mean, na.rm=FALSE)
averaged_by_site_BEO$station <- c("BEO") 

averaged_by_site_SSMH <- SPRING23_ALLDEPTHS %>% filter(fullname == "SSMH-BASE" | fullname == "SSMH-SA" | fullname == "SSMH-SB"| fullname == "SSMH-SC" | fullname == "SSMH-SD") %>% aggregate(value~date+depth+val, mean, na.rm=FALSE)
averaged_by_site_SSMH$station <- c("SSMH")

SITES_AVG_SPRING23_GRND <- rbind(averaged_by_site_BEO, averaged_by_site_TNHA, averaged_by_site_SSMH)
```


*SPRING 23*  STATS: average daily difference between SITES (all stations combined) for Xcm depth (define in x <- )
```{r}
wide <- SITES_AVG_SPRING23_GRND %>%
    pivot_wider(names_from = station, values_from = value)

wide$TBDIFF <- wide$TNHA - wide$BEO
wide$SBDIFF <- wide$SSMH - wide$BEO
wide$TBSBDIFF <- wide$SSMH - wide$TNHA

x<- wide %>% filter(depth == "10cm") 
mean(x$TBDIFF,na.rm = TRUE)
mean(x$SBDIFF, na.rm = TRUE)
mean(x$TBSBDIFF, na.rm = TRUE)
```

*SPRING 23*  AVERAGE BY STATION (can compare sensors at the same site, such as N & S) by day
```{r}
averaged_by_station <- SPRING23_ALLDEPTHS %>% filter(fullname == "TNHA-SA") %>% aggregate(value~date+depth, mean)
averaged_by_station$fullname <- c("TNHA-SA")
averaged_by_station2 <- SPRING23_ALLDEPTHS %>% filter(fullname == "TNHA-SC") %>% aggregate(value~date+depth, mean)
averaged_by_station2$fullname <- c("TNHA-SC")
#averaged_by_station3 <- SPRING23_ALLDEPTHS %>% filter(fullname == "SSMH-SA") %>% aggregate(value~date+depth, mean)
averaged_by_station3$fullname <- c("SSMH-SA")
#above, no rows to agg? check DF

averaged_by_station4 <- SPRING23_ALLDEPTHS %>% filter(fullname == "SSMH-SB") %>% aggregate(value~date+depth, mean)
averaged_by_station4$fullname <- c("SSMH-SB")
averaged_by_station5 <- SPRING23_ALLDEPTHS %>% filter(fullname == "BEO-B05" | fullname == "BEO-B06") %>% aggregate(value~date+depth, mean)
averaged_by_station5$fullname <- c("BEO")
SPRING23_STATIONS_AVG<- rbind(averaged_by_station, averaged_by_station2, averaged_by_station4,averaged_by_station5)
```


*SPRING 23* STATS: average daily difference between SPECIFIC STATIONS for Xcm depth (define in x <- )
```{r}
wide <- SPRING23_STATIONS_AVG %>%
    pivot_wider(names_from = fullname, values_from = value)

wide$TNHA_NS_DIFF <- wide$`TNHA-SA` - wide$`TNHA-SC`
wide$TNHA_N_BEO_DIFF <- wide$`TNHA-SC` - wide$`BEO`
wide$TNHA_S_BEO_DIFF <- wide$`TNHA-SA` - wide$`BEO`

wide$SSMH_NS_DIFF <- wide$`SSMH-SA` - wide$`SSMH-SB`
wide$SSMH_N_BEO_DIFF <- wide$`SSMH-SB` - wide$`BEO`
wide$SSMH_S_BEO_DIFF <- wide$`SSMH-SA` - wide$`BEO`

wide$TNHA_SSMH_N_COMP <- wide$`TNHA-SC`-wide$`SSMH-SB`
wide$TNHA_SSMH_S_COMP <- wide$`TNHA-SA`-wide$`SSMH-SA`

#write.csv(wide, "~/Desktop/UVA/RESEARCH/Barrow/Meteorological_Seasons_Data/Summer_daily_average_difference_N_vs_S.csv")

x<- wide %>% filter(depth == "30cm") 

mean(x$TNHA_NS_DIFF,na.rm = TRUE)
mean(x$SSMH_NS_DIFF, na.rm = TRUE)
mean(x$TNHA_S_BEO_DIFF, na.rm = TRUE)
mean(x$SSMH_S_BEO_DIFF, na.rm = TRUE)
max(x$TNHA_NS_DIFF, na.rm = TRUE)
max(x$SSMH_NS_DIFF, na.rm = TRUE)


#below, p1 = 6/19-8/01 , p2= 8/01-
p3 = with(x, mean(TNHA_SSMH_N_COMP[date >= "2023-03-01" & date <= "2023-06-01"]), na.rm = FALSE)

#CHANGE DATA RANGE ABOVE

```

------

*SUMMER 23*
--------
```{r}
averaged_by_site_TNHA <- SUMMERGRND23_ALLDEPTHS %>% filter(fullname == "TNHA-BASE" | fullname == "TNHA-SA" | fullname == "TNHA-SB"| fullname == "TNHA-SC" | fullname == "TNHA-SD") %>% aggregate(value~date+depth+val, mean, na.rm=FALSE)
averaged_by_site_TNHA$station <- c("TNHA")

averaged_by_site_BEO <- SUMMERGRND23_ALLDEPTHS %>% filter(fullname == "BEO-B06" | fullname == "BEO-B05") %>% aggregate(value~date+depth+val, mean, na.rm=FALSE)
averaged_by_site_BEO$station <- c("BEO") 

averaged_by_site_SSMH <- SUMMERGRND23_ALLDEPTHS %>% filter(fullname == "SSMH-BASE" | fullname == "SSMH-SA" | fullname == "SSMH-SB"| fullname == "SSMH-SC" | fullname == "SSMH-SD" | fullname == "SSMH-SE" | fullname == "SSMH-SF" | fullname == "SSMH-SG" | fullname == "SSMH-SH" | fullname == "SSMH-SI") %>% aggregate(value~date+depth+val, mean, na.rm=FALSE)
averaged_by_site_SSMH$station <- c("SSMH")

SITES_AVG_SUMM23_GRND <- rbind(averaged_by_site_BEO, averaged_by_site_TNHA, averaged_by_site_SSMH)
```


*SUMMER 23* STATS: average daily difference between SITES (all stations combined) for Xcm depth (define in x <- )
```{r}
wide <- SITES_AVG_SUMM23_GRND %>%
    pivot_wider(names_from = station, values_from = value)

wide$TBDIFF <- wide$TNHA - wide$BEO
wide$SBDIFF <- wide$SSMH - wide$BEO
wide$TBSBDIFF <- wide$SSMH - wide$TNHA

x<- wide %>% filter(depth == "10cm") 
mean(x$TBDIFF,na.rm = TRUE)
mean(x$SBDIFF, na.rm = TRUE)
mean(x$TBSBDIFF, na.rm = TRUE)
```

*SUMMER 23* AVERAGE BY STATION (can compare sensors at the same site, such as N & S) by day
```{r}
averaged_by_station <- SUMMERGRND23_ALLDEPTHS %>% filter(fullname == "TNHA-SA") %>% aggregate(value~date+depth, mean)
averaged_by_station$fullname <- c("TNHA-SA")
averaged_by_station2 <- SUMMERGRND23_ALLDEPTHS %>% filter(fullname == "TNHA-SC") %>% aggregate(value~date+depth, mean)
averaged_by_station2$fullname <- c("TNHA-SC")

averaged_by_station3 <- SUMMERGRND23_ALLDEPTHS %>% filter(fullname == "SSMH-SA") %>% aggregate(value~date+depth, mean)
averaged_by_station3$fullname <- c("SSMH-SA")
averaged_by_station4 <- SUMMERGRND23_ALLDEPTHS %>% filter(fullname == "SSMH-SB") %>% aggregate(value~date+depth, mean)
averaged_by_station4$fullname <- c("SSMH-SB")
averaged_by_station5 <- SUMMERGRND23_ALLDEPTHS %>% filter(fullname == "BEO-B05" | fullname == "BEO-B06") %>% aggregate(value~date+depth, mean)
averaged_by_station5$fullname <- c("BEO")

#averaged_by_station5_NEW <- SUMMERGRND23_ALLDEPTHS %>% filter(fullname == "BEO-B07" | fullname == "BEO-B08") %>% aggregate(value~date+depth, mean)
#averaged_by_station5_NEW$fullname <- c("BEO-NEW")

averaged_by_station6 <- SUMMERGRND23_ALLDEPTHS %>% filter(fullname == "TNHA-BASE") %>% aggregate(value~date+depth, mean)
averaged_by_station6$fullname <- c("TNHA-BASE")

averaged_by_station7 <- SUMMERGRND23_ALLDEPTHS %>% filter(fullname == "TNHA-SD") %>% aggregate(value~date+depth, mean)
averaged_by_station7$fullname <- c("TNHA-SD")

averaged_by_station8 <- SUMMERGRND23_ALLDEPTHS %>% filter(fullname == "TNHA-SB") %>% aggregate(value~date+depth, mean)
averaged_by_station8$fullname <- c("TNHA-SB")


#averaged_by_station8 <- SUMMERGRND23_ALLDEPTHS %>% filter(fullname == "SSMH-BASE") %>% aggregate(value~date+depth, mean)
#averaged_by_station8$fullname <- c("SSMH-BASE")
#above, no rows to aggregate (no data)

averaged_by_station9 <- SUMMERGRND23_ALLDEPTHS %>% filter(fullname == "SSMH-SD") %>% aggregate(value~date+depth, mean)
averaged_by_station9$fullname <- c("SSMH-SD")


SUM23_STATIONS_AVG<- rbind(averaged_by_station, averaged_by_station2, averaged_by_station3,averaged_by_station4,averaged_by_station5,averaged_by_station6,averaged_by_station7,averaged_by_station9,averaged_by_station8)
```


*SUMMER 23* STATS: average daily difference between SPECIFIC STATIONS for Xcm depth (define in x <- )
```{r}
wide <- SUM23_STATIONS_AVG %>%
    pivot_wider(names_from = fullname, values_from = value)

wide$TNHA_NS_DIFF <- wide$`TNHA-SA` - wide$`TNHA-SC`
wide$TNHA_N_BEO_DIFF <- wide$`TNHA-SC` - wide$`BEO`
wide$TNHA_S_BEO_DIFF <- wide$`TNHA-SA` - wide$`BEO`

wide$SSMH_NS_DIFF <- wide$`SSMH-SA` - wide$`SSMH-SB`
wide$SSMH_N_BEO_DIFF <- wide$`SSMH-SB` - wide$`BEO`
wide$SSMH_S_BEO_DIFF <- wide$`SSMH-SA` - wide$`BEO`

wide$TNHA_SSMH_N_COMP <- wide$`TNHA-SC`-wide$`SSMH-SB`
wide$TNHA_SSMH_S_COMP <- wide$`TNHA-SA`-wide$`SSMH-SA`

#write.csv(wide, "~/Desktop/UVA/RESEARCH/Barrow/Meteorological_Seasons_Data/Summer_daily_average_difference_N_vs_S.csv")

x<- wide %>% filter(depth == "90cm" & date >= "2023-06-01" & date <= "2023-09-01") 

mean(x$TNHA_NS_DIFF,na.rm = TRUE)
mean(x$SSMH_NS_DIFF, na.rm = TRUE)
mean(x$TNHA_S_BEO_DIFF, na.rm = TRUE)
mean(x$SSMH_S_BEO_DIFF, na.rm = TRUE)
max(x$TNHA_NS_DIFF, na.rm = TRUE)
max(x$SSMH_NS_DIFF, na.rm = TRUE)

#below, p1 = 6/19-8/01 , p2= 8/01-
p3 = with(x, mean(TNHA_S_BEO_DIFF), na.rm = TRUE)

#CHANGE DATA RANGE ABOVE (adjusted as of now, 10:50am 1/10/24)

```


*FALL 23*
----- 
STATS: average daily difference between SITES (all stations combined) for Xcm depth (define in x <- )
```{r}
wide <- FALL23_ALLDEPTHS %>%
    pivot_wider(names_from = station, values_from = value)

wide$TBDIFF <- wide$TNHA - wide$BEO
wide$SBDIFF <- wide$SSMH - wide$BEO
wide$TBSBDIFF <- wide$SSMH - wide$TNHA

x<- wide %>% filter(depth == "10cm") 
mean(x$TBDIFF,na.rm = TRUE)
mean(x$SBDIFF, na.rm = TRUE)
mean(x$TBSBDIFF, na.rm = TRUE)
```

*FALL 23* AVERAGE BY STATION (can compare sensors at the same site, such as N & S) by day
```{r}
averaged_by_station <- FALL23_ALLDEPTHS %>% filter(fullname == "TNHA-SA") %>% aggregate(value~date+depth, mean)
averaged_by_station$fullname <- c("TNHA-SA")
averaged_by_station2 <- FALL23_ALLDEPTHS %>% filter(fullname == "TNHA-SC") %>% aggregate(value~date+depth, mean)
averaged_by_station2$fullname <- c("TNHA-SC")

averaged_by_station3 <- FALL23_ALLDEPTHS %>% filter(fullname == "SSMH-SA") %>% aggregate(value~date+depth, mean)
averaged_by_station3$fullname <- c("SSMH-SA")
averaged_by_station4 <- FALL23_ALLDEPTHS %>% filter(fullname == "SSMH-SB") %>% aggregate(value~date+depth, mean)
averaged_by_station4$fullname <- c("SSMH-SB")
# averaged_by_station5 <- FALL23_ALLDEPTHS %>% filter(fullname == "BEO-B05" | fullname == "BEO-B06") %>% aggregate(value~date+depth, mean)
# averaged_by_station5$fullname <- c("BEO")

averaged_by_station6 <- FALL23_ALLDEPTHS %>% filter(fullname == "TNHA-BASE") %>% aggregate(value~date+depth, mean)
averaged_by_station6$fullname <- c("TNHA-BASE")

# averaged_by_station7 <- FALL23_ALLDEPTHS %>% filter(fullname == "TNHA-SD") %>% aggregate(value~date+depth, mean)
# averaged_by_station7$fullname <- c("TNHA-SD")

averaged_by_station8 <- FALL23_ALLDEPTHS %>% filter(fullname == "TNHA-SB") %>% aggregate(value~date+depth, mean)
averaged_by_station8$fullname <- c("TNHA-SB")


#averaged_by_station8 <- SUMMERGRND23_ALLDEPTHS %>% filter(fullname == "SSMH-BASE") %>% aggregate(value~date+depth, mean)
#averaged_by_station8$fullname <- c("SSMH-BASE")
#above, no rows to aggregate (no data)

averaged_by_station10 <- FALL23_ALLDEPTHS %>% filter(fullname == "SSMH-SE") %>% aggregate(value~date+depth, mean)
averaged_by_station10$fullname <- c("SSMH-SE")

averaged_by_station11 <- FALL23_ALLDEPTHS %>% filter(fullname == "SSMH-SF") %>% aggregate(value~date+depth, mean)
averaged_by_station11$fullname <- c("SSMH-SF")

averaged_by_station12 <- FALL23_ALLDEPTHS %>% filter(fullname == "SSMH-SG") %>% aggregate(value~date+depth, mean)
averaged_by_station12$fullname <- c("SSMH-SG")

averaged_by_station13 <- FALL23_ALLDEPTHS %>% filter(fullname == "SSMH-SH") %>% aggregate(value~date+depth, mean)
averaged_by_station13$fullname <- c("SSMH-SH")

averaged_by_station14 <- FALL23_ALLDEPTHS %>% filter(fullname == "SSMH-SI") %>% aggregate(value~date+depth, mean)
averaged_by_station14$fullname <- c("SSMH-SI")


FALL23_STATIONS_AVG<- rbind(averaged_by_station, averaged_by_station2, averaged_by_station3,averaged_by_station4,averaged_by_station5,averaged_by_station6,averaged_by_station7,averaged_by_station9,averaged_by_station8,averaged_by_station11,averaged_by_station13,averaged_by_station14)
```


*FALL 23* STATS: average daily difference between SPECIFIC STATIONS for Xcm depth (define in x <- )
```{r}
wide <- FALL23_STATIONS_AVG %>%
    pivot_wider(names_from = fullname, values_from = value)

wide$TNHA_NS_DIFF <- wide$`TNHA-BASE` - wide$`TNHA-SC`
wide$TNHA_N_BEO_DIFF <- wide$`TNHA-SC` - wide$`BEO`
wide$TNHA_S_BEO_DIFF <- wide$`TNHA-SA` - wide$`BEO`

wide$SSMH_NS_DIFF <- wide$`SSMH-SA` - wide$`SSMH-SB`
wide$SSMH_N_BEO_DIFF <- wide$`SSMH-SB` - wide$`BEO`
wide$SSMH_S_BEO_DIFF <- wide$`SSMH-SA` - wide$`BEO`

wide$TNHA_SSMH_N_COMP <- wide$`TNHA-SC`-wide$`SSMH-SB`
wide$TNHA_SSMH_S_COMP <- wide$`TNHA-SA`-wide$`SSMH-SA`

#write.csv(wide, "~/Desktop/UVA/RESEARCH/Barrow/Meteorological_Seasons_Data/Summer_daily_average_difference_N_vs_S.csv")

x<- wide %>% filter(depth == "90cm"& date >= "2023-09-01" & date <= "2023-12-01") 

mean(x$TNHA_NS_DIFF,na.rm = TRUE)
mean(x$SSMH_NS_DIFF, na.rm = TRUE)
mean(x$TNHA_S_BEO_DIFF, na.rm = TRUE)
mean(x$SSMH_S_BEO_DIFF, na.rm = TRUE)
max(x$TNHA_NS_DIFF, na.rm = TRUE)
max(x$SSMH_NS_DIFF, na.rm = TRUE)

#below, p1 = 6/19-8/01 , p2= 8/01-
p3 = with(x, mean(TNHA_SSMH_N_COMP[date >= "2023-06-01" & date <= "2023-09-01"]))

#using TNHA-BASE AS THE SOUTH FACING SENSOR -- NEED TO PUT THIS IN METADATA

```











AIR TEMPERATURES AVERAGING

*(summer 22 AIR)*
```{r}
AIRmean <- summer22airtemp %>% subset() %>% select(value,sensor,Date) %>% filter( !value == "-888.8") 

AIRmean %>%
  mutate(date = day(Date))  %>%
  group_by(date,sensor,value) %>%
  summarize(mean_X1 = mean(value)) %>% 
  aggregate( value ~ sensor, mean ) %>%
  group_by(sensor)

AIRmean$time <- format(as.Date(
  AIRmean$Date),format = "%H:%M:%S")
AIRmean$day <- as.Date(AIRmean$Date)


Daily_average_air_per_sensor <- AIRmean %>% 
  group_by(sensor, day) %>%
  aggregate(value ~ sensor + day, mean)


Daily_average_air_per_sensor <-  cSplit(Daily_average_air_per_sensor, 'sensor', sep="-", direction = "wide")
colnames(Daily_average_air_per_sensor)[1:4] <- c("date","value","station","sensor")
Daily_average_air_per_sensor$fullname <- paste(Daily_average_air_per_sensor$station,Daily_average_air_per_sensor$sensor,sep="-")


TNHA_DAILY <- Daily_average_air_per_sensor %>% filter(station == "TNHA")
SSMH_DAILY<- Daily_average_air_per_sensor %>% filter(station == "SSMH")
BEO_DAILY<- Daily_average_air_per_sensor %>% filter(station == "BEO")


date <- rep(seq(as.Date("2022-06-19"), as.Date("2022-09-01"), by="day"),5)
val <- rep(1,length(date))
fullname <- rep(c("TNHA-BASE", "TNHA-SA", "TNHA-SB", "TNHA-SC", "TNHA-SD"),each=75)
testdf <- data.frame(date,fullname,val)
TNHA_NONA <- left_join(testdf,TNHA_DAILY, by=c("date","fullname"))

fullname <- rep(c("SSMH-BASE", "SSMH-SA", "SSMH-SB", "SSMH-SC", "SSMH-SD"),each=75)
testdf2 <- data.frame(date,fullname,val)
SSMH_NONA <- left_join(testdf2,SSMH_DAILY, by=c("date","fullname"))

fullname <- rep(c("BEO-BASE"),each=75)
testdf3 <- data.frame(date,fullname,val)
BEO_NONA <- left_join(testdf3,BEO_DAILY, by=c("date","fullname"))

SUMMER22_air <- rbind(TNHA_NONA,BEO_NONA,SSMH_NONA)
```

*(summer 22 AIR)*average daily difference between TNHA and BEO SITES (all stations combined) 
```{r}
wide <- SUMMER22_air %>%
    pivot_wider(names_from = station, values_from = value)

wide$TBDIFF <- wide$TNHA - wide$BEO


mean(wide$TBDIFF,na.rm = TRUE)
mean(wide$SBDIFF, na.rm = TRUE)
mean(wide$TBSBDIFF, na.rm = TRUE)
```

*(summer 22 AIR)* This averages for SENSOR (can compare sensors at the same site, such as N & S) by day for AIR
```{r}
averaged_by_station <- SUMMER22_air %>% filter(fullname == "TNHA-SA") %>% aggregate(value~date, mean)
averaged_by_station$fullname <- c("TNHA-SA")

averaged_by_station2 <- SUMMER22_air %>% filter(fullname == "TNHA-SC") %>% aggregate(value~date, mean)
averaged_by_station2$fullname <- c("TNHA-SC")

averaged_by_station3 <- SUMMER22_air %>% filter(fullname == "BEO-BASE") %>% aggregate(value~date, mean)
averaged_by_station3$fullname <- c("BEO-BASE")
TNHA_NvsS <- rbind(averaged_by_station, averaged_by_station2, averaged_by_station3)
```

*(summer 22 AIR)*average daily difference between SPECIFIC STATIONS at TNHA and BEO
```{r}
wide <- TNHA_NvsS %>%
    pivot_wider(names_from = fullname, values_from = value)

wide$TNHA_NS_DIFF <- wide$`TNHA-SA` - wide$`TNHA-SC`
wide$TNHA_SN_DIFF <- wide$`TNHA-SC` - wide$`TNHA-SA`
wide$TNHA_N_BEO_DIFF <- wide$`TNHA-SC` - wide$`BEO-BASE`
wide$TNHA_S_BEO_DIFF <- wide$`TNHA-SA` - wide$`BEO-BASE`



mean(wide$TNHA_NS_DIFF,na.rm = TRUE)

mean(wide$TNHA_S_BEO_DIFF, na.rm = TRUE)

max(x$TNHA_NS_DIFF, na.rm = TRUE)

```
